<div class="personne-crud-container">
  <h2>Gestion des Personnes</h2>
  
  <div *ngIf="toastMessage" class="toast" [ngClass]="toastType" @toastAnimation>
    {{ toastMessage }}
  </div>
  
  <button (click)="openForm()" class="btn btn-primary btn-icon">
    <span class="material-icons">person_add</span> Nouveau
  </button>

  <div class="table-container">
    <table class="table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nom</th>
          <th>Prénom</th>
          <th>Poste</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of personnes; trackBy: trackById" @rowAnimation>
          <td>{{ p.id }}</td>
          <td>{{ p.nom }}</td>
          <td>{{ p.prenom }}</td>
          <td>{{ p.poste }}</td>
          <td>
            <button (click)="openForm(p)" class="btn btn-sm btn-warning btn-icon" title="Modifier">
              <span class="material-icons">edit</span>
            </button>
            <button (click)="confirmDelete(p.id!)" class="btn btn-sm btn-danger btn-icon" title="Supprimer">
              <span class="material-icons">delete</span>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Modal -->
  <div class="modal-backdrop" [class.show]="showForm" (click)="closeForm()"></div>
  <div class="modal" [class.show]="showForm" @modalAnimation>
    <div class="modal-content">
      <span class="close" (click)="closeForm()">&times;</span>
      <h3>{{ editingPersonne ? 'Modifier Personne' : 'Ajouter Personne' }}</h3>

      <form [formGroup]="personneForm" (ngSubmit)="submitForm()">
        <div class="form-group">
          <label>Nom</label>
          <input formControlName="nom" [class.invalid]="personneForm.get('nom')?.invalid && personneForm.get('nom')?.touched" />
          <div *ngIf="personneForm.get('nom')?.invalid && personneForm.get('nom')?.touched" class="error-message">
            Le nom est requis
          </div>
        </div>
        <div class="form-group">
          <label>Prénom</label>
          <input formControlName="prenom" [class.invalid]="personneForm.get('prenom')?.invalid && personneForm.get('prenom')?.touched" />
          <div *ngIf="personneForm.get('prenom')?.invalid && personneForm.get('prenom')?.touched" class="error-message">
            Le prénom est requis
          </div>
        </div>
        <div class="form-group">
          <label>Poste</label>
          <input formControlName="poste" />
        </div>
        <div class="form-actions">
          <button type="submit" class="btn btn-success btn-icon" [disabled]="personneForm.invalid">
            <span class="material-icons">{{ editingPersonne ? 'edit' : 'person_add' }}</span>
            {{ editingPersonne ? 'Modifier' : 'Ajouter' }}
          </button>
          <button type="button" (click)="closeForm()" class="btn btn-secondary btn-icon">
            <span class="material-icons">close</span> Annuler
          </button>
        </div>
      </form>
    </div>
  </div>
</div>