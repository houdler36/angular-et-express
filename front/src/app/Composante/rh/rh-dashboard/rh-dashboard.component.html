<div class="flex-container">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="header-container">
      <img src="/images/salafan.jpg" alt="Logo SALFA" class="header-logo">
      <h6 class="header-title">Sampan'Asa Loterana momba ny FAhasalamana</h6>
    </div>
    <nav>
      <a role="button" [class.active]="activePage === 'Dashboard'" (click)="setActivePage('Dashboard')">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
          <polyline points="9 22 9 12 15 12 15 22" />
        </svg>
        <span class="hidden-mobile">Tableau de Bord</span>
      </a>
      <a role="button" [class.active]="activePage === 'demandesATraiter'" (click)="setActivePage('demandesATraiter')">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" />
          <polyline points="14 2 14 8 20 8" />
        </svg>
        <span class="hidden-mobile">Demandes Ã  traiter</span>
      </a>
      <a role="button" [class.active]="activePage === 'demandesEnAttente'" (click)="setActivePage('demandesEnAttente')">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10" />
          <polyline points="12 6 12 12 16 14" />
        </svg>
        <span class="hidden-mobile">Demandes en attente</span>
      </a>
      <a role="button" [class.active]="activePage === 'demandesApprouvees'" (click)="setActivePage('demandesApprouvees')">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <polyline points="20 6 9 17 4 12" />
        </svg>
        <span class="hidden-mobile">Demandes approuvÃ©es</span>
      </a>
      <a role="button" [class.active]="activePage === 'profil'" (click)="setActivePage('profil')">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="7" r="4" />
          <path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2" />
        </svg>
        <span class="hidden-mobile">Mon Profil</span>
      </a>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <div class="card">
      <!-- Tableau de Bord -->
      <div *ngIf="activePage === 'Dashboard'" class="content-section">
        <h1 class="page-title">Tableau de Bord</h1>
        <div class="stats-grid">
          <div class="stat-card">
            <h3>Demandes Ã  traiter</h3>
            <p class="stat-number">{{ demandesATraiter.length }}</p>
          </div>
          <div class="stat-card">
            <h3>Demandes en attente</h3>
            <p class="stat-number">{{ demandesEnAttente.length }}</p>
          </div>
          <div class="stat-card">
            <h3>Demandes finalisÃ©es</h3>
            <p class="stat-number">{{ demandesFinalisees.length }}</p>
          </div>
        </div>
      </div>

      <!-- Demandes Ã  traiter -->
      <div *ngIf="activePage === 'demandesATraiter'" class="content-section">
        <h2 class="text-2xl font-bold mb-4 page-title">Demandes Ã  traiter</h2>
        <p *ngIf="loadingATraiter" class="text-gray-500 loading-text">Chargement...</p>
        <table *ngIf="!loadingATraiter && demandesATraiter.length > 0" class="fade-in-table">
          <thead>
            <tr>
              <th>Titre</th>
              <th>Montant</th>
              <th>Status</th>
              <th>Validateurs du journal</th>
              <th>Actions</th>
              <th>DÃ©tails</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let demande of demandesATraiter">
              <td>{{ demande.description || 'â€”' }}</td>
              <td>{{ demande.montant_total | currency:'MGA':'symbol':'1.0-0' }}</td>
              <td>{{ demande.status }}</td>
              <td>
                <ul>
                  <li *ngFor="let validateur of demande.journal?.journal_validers || []">
                    {{ validateur.user?.username || 'N/A' }} (Ordre {{ validateur.ordre }})
                  </li>
                </ul>
              </td>
              <td>
                <button *ngIf="demande.estTourUtilisateur" (click)="valider(demande.id)" class="icon-btn text-green-600 hover:text-green-800">âœ…</button>
                <button *ngIf="demande.estTourUtilisateur" (click)="refuser(demande.id)" class="icon-btn text-red-600 hover:text-red-800">âŒ</button>
                <span *ngIf="!demande.estTourUtilisateur" class="icon-btn text-gray-400">ğŸ”’</span>
              </td>
              <td>
                <button (click)="voirDetails(demande.id)" class="icon-btn text-blue-600 hover:text-blue-800">ğŸ‘ï¸</button>
              </td>
            </tr>
          </tbody>
        </table>
        <p *ngIf="!loadingATraiter && demandesATraiter.length === 0" class="text-gray-500 italic">Aucune demande Ã  traiter actuellement</p>
      </div>

      <!-- Demandes en attente -->
      <div *ngIf="activePage === 'demandesEnAttente'" class="content-section">
        <h2 class="text-2xl font-bold mb-4 page-title">Demandes en attente</h2>
        <p *ngIf="loadingEnAttente" class="text-gray-500">Chargement...</p>
        <table *ngIf="!loadingEnAttente && demandesEnAttente.length > 0" class="fade-in-table">
          <thead>
            <tr>
              <th>Titre</th>
              <th>Montant</th>
              <th>Status</th>
              <th>Validateurs du journal</th>
              <th>Validateur actuel</th>
              <th>DÃ©tails</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let demande of demandesEnAttente">
              <td>{{ demande.description || 'â€”' }}</td>
              <td>{{ demande.montant_total | currency:'MGA':'symbol':'1.0-0' }}</td>
              <td>{{ demande.status }}</td>
              <td>
                <ul>
                  <li *ngFor="let validateur of demande.journal?.journal_validers || []">
                    {{ validateur.user?.username || 'N/A' }} (Ordre {{ validateur.ordre }})
                  </li>
                </ul>
              </td>
              <td>{{ demande.currentValidator || 'â€”' }}</td>
              <td>
                <button (click)="voirDetails(demande.id)" class="icon-btn text-blue-600 hover:text-blue-800">ğŸ‘ï¸</button>
              </td>
            </tr>
          </tbody>
        </table>
        <p *ngIf="!loadingEnAttente && demandesEnAttente.length === 0" class="text-gray-500 italic">
          Aucune demande en attente chez d'autres validateurs
        </p>
      </div>

      <!-- Demandes approuvÃ©es -->
      <div *ngIf="activePage === 'demandesApprouvees'" class="content-section">
        <h2 class="text-2xl font-bold mb-4 page-title">Demandes approuvÃ©es</h2>
        <p *ngIf="loadingFinalisees" class="text-gray-500">Chargement...</p>
        <table *ngIf="!loadingFinalisees && demandesFinalisees.length > 0" class="fade-in-table">
          <thead>
            <tr>
              <th>Titre</th>
              <th>Montant</th>
              <th>Status</th>
              <th>Validateurs du journal</th>
              <th>Validateur final</th>
              <th>DÃ©tails</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let demande of demandesFinalisees">
              <td>{{ demande.description || 'â€”' }}</td>
              <td>{{ demande.montant_total | currency:'MGA':'symbol':'1.0-0' }}</td>
              <td>{{ demande.status }}</td>
              <td>
                <ul>
                  <li *ngFor="let validateur of demande.journal?.journal_validers || []">
                    {{ validateur.user?.username || 'N/A' }} (Ordre {{ validateur.ordre }})
                  </li>
                </ul>
              </td>
              <td>{{ demande.finalValidatorName || 'â€”' }}</td>
              <td>
                <button (click)="voirDetails(demande.id)" class="icon-btn text-blue-600 hover:text-blue-800">ğŸ‘ï¸</button>
              </td>
            </tr>
          </tbody>
        </table>
        <p *ngIf="!loadingFinalisees && demandesFinalisees.length === 0" class="text-gray-500 italic">
          Aucune demande approuvÃ©e pour le moment
        </p>
      </div>

      <!-- Mon Profil -->
      <div *ngIf="activePage === 'profil'" class="content-section">
        <h2 class="text-2xl font-bold mb-4 page-title">Mon Profil</h2>

        <!-- Formulaire mot de passe -->
        <form [formGroup]="profilForm" (ngSubmit)="changerMotDePasse()" class="profil-form">
          <div class="form-group mb-4">
            <label>Mot de passe actuel</label>
            <input type="password" formControlName="currentPassword" placeholder="Mot de passe actuel" class="input-field">
          </div>
          <div class="form-group mb-4">
            <label>Nouveau mot de passe</label>
            <input type="password" formControlName="newPassword" placeholder="Nouveau mot de passe" class="input-field">
          </div>
          <div class="form-group mb-4">
            <label>Confirmer le mot de passe</label>
            <input type="password" formControlName="confirmPassword" placeholder="Confirmer le nouveau mot de passe" class="input-field">
          </div>
          <button type="submit" class="btn-submit bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Changer le mot de passe</button>
          <p class="text-green-600 mt-2" *ngIf="messageSuccess">{{ messageSuccess }}</p>
          <p class="text-red-600 mt-2" *ngIf="messageError">{{ messageError }}</p>
        </form>

        <!-- Changement signature -->
        <div class="p-4 mt-8">
          <h2 class="text-2xl font-bold mb-4 page-title">Changer ma signature</h2>
          <div class="form-group mb-4">
            <input type="file" (change)="onFileSelected($event)" class="input-field">
          </div>
          <button (click)="changerSignature()" class="btn-submit bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
            Mettre Ã  jour la signature
          </button>
          <p class="text-green-600 mt-2" *ngIf="messageSignature">{{ messageSignature }}</p>
        </div>

        <!-- RemplaÃ§ant RH -->
       <div *ngIf="currentUser && currentUser.role === 'rh'" class="p-4 mt-8">
  <h2 class="text-2xl font-bold mb-4 page-title">DÃ©finir mon remplaÃ§ant</h2>
  <div class="form-group mb-4" *ngIf="currentUser?.role === 'rh'">
  <label>Choisir un remplaÃ§ant RH</label>
  <select [(ngModel)]="selectedDelegueId" class="input-field" [disabled]="autresRH.length === 0">
    <option [value]="null">-- Aucun --</option>
    <option *ngIf="autresRH.length === 0" disabled>{{ messageDelegue }}</option>
    <option *ngFor="let rh of autresRH" [value]="rh.id">{{ rh.username }}</option>
  </select>
</div>

  <button (click)="changerDelegue()" 
          class="btn-submit bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700"
          [disabled]="autresRH.length === 0">
    Mettre Ã  jour le remplaÃ§ant
  </button>
  <p class="text-green-600 mt-2" *ngIf="messageDelegue">{{ messageDelegue }}</p>
</div>

      </div>
    </div>
  </main>
</div>
