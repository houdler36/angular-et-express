<div class="dashboard-wrapper">

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <img src="images/salafan.jpg" alt="Logo SALFA" class="sidebar-logo">
    </div>

    <nav class="sidebar-nav">
      <a (click)="toggleAccueil(true)" class="nav-item" [class.active]="showAccueil">
        <i class="fas fa-home"></i>
        <span>Accueil</span>
      </a>

      <a (click)="toggleTableauDeBord(true)" class="nav-item" [class.active]="showTableauDeBord">
        <i class="fas fa-chart-line"></i>
        <span>Tableau de bord</span>
      </a>

      <hr class="sidebar-divider">

      <a (click)="toggleNewDemandeForm(true)" class="nav-item" [class.active]="showNewDemandeForm">
        <i class="fas fa-plus-circle"></i>
        <span>Nouvelle demande</span>
      </a>

      <a (click)="toggleDemandeList(true)" class="nav-item" [class.active]="showDemandeList">
        <i class="fas fa-list"></i>
        <span>Liste des demandes</span>
      </a>

      <hr class="sidebar-divider">

      <a (click)="toggleDemandeRecap(true)" class="nav-item" [class.active]="showDemandeRecap">
        <i class="fas fa-chart-pie"></i>
        <span>ERD</span>
      </a>

      <a (click)="toggleRapportDemande(true)" class="nav-item" [class.active]="showRapportDemande">
        <i class="fas fa-file-alt"></i>
        <span>Rapport</span>
      </a>

      <hr class="sidebar-divider">

      <a (click)="toggleProfile(true)" class="nav-item" [class.active]="showProfile">
        <i class="fas fa-user"></i>
        <span>Mon Profil</span>
      </a>
    </nav>
  </aside>

  <!-- Main Content -->
  <div class="main-content">

    <div *ngIf="showAccueil" class="dashboard-home">
  <h2 class="accueil-title">Bienvenue {{ currentUser?.username }}</h2>
  <p class="accueil-slogan">Gérez vos demandes facilement et restez informé en temps réel.</p>

  <!-- Cartes de statistiques principales -->
  <div class="accueil-highlights">
    <div class="highlight-card">
      <div class="highlight-icon pending">
        <i class="fas fa-clock"></i>
      </div>
      <div class="highlight-content">
        <h3>Demandes en attente</h3>
        <p class="highlight-value">{{ demandesEnAttente }}</p>
        <p class="highlight-desc">nécessitent votre attention</p>
      </div>
    </div>

    <div class="highlight-card">
      <div class="highlight-icon approved">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="highlight-content">
        <h3>Demandes approuvées</h3>
        <p class="highlight-value">{{ demandesApprouvees }}</p>
        <p class="highlight-desc">ce mois-ci</p>
      </div>
    </div>

    <div class="highlight-card">
      <div class="highlight-icon efficiency">
        <i class="fas fa-chart-line"></i>
      </div>
      <div class="highlight-content">
        <h3>Efficacité</h3>
        <p class="highlight-value">{{ calculateEfficiency() }}%</p>
        <p class="highlight-desc">taux de traitement</p>
      </div>
    </div>
  </div>

  <!-- Conteneur pour activités et conseils côte à côte -->
  <div class="accueil-bottom-sections">
    <!-- Section activités récentes -->
    <div class="recent-activities">
      <h3><i class="fas fa-history"></i> Activités récentes</h3>
      <div class="activity-list">
        <div class="activity-item" *ngFor="let activity of recentActivities">
          <div class="activity-icon" [ngClass]="activity.type">
            <i [class]="activity.icon"></i>
          </div>
          <div class="activity-details">
            <p class="activity-text">{{ activity.text }}</p>
            <span class="activity-time">{{ activity.time }}</span>
          </div>
        </div>
        <div class="activity-item" *ngIf="recentActivities.length === 0">
          <div class="activity-icon info">
            <i class="fas fa-info-circle"></i>
          </div>
          <div class="activity-details">
            <p class="activity-text">Aucune activité récente</p>
            <span class="activity-time">Commencez par créer une demande</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Section conseils rapides -->
    <div class="quick-tips">
      <h3><i class="fas fa-lightbulb"></i> Conseils rapides</h3>
      <div class="tips-container">
        <div class="tip">
          <i class="fas fa-check-circle"></i>
          <p>Vérifiez régulièrement vos demandes en attente pour éviter les retards.</p>
        </div>
        <div class="tip">
          <i class="fas fa-filter"></i>
          <p>Utilisez les filtres pour trouver rapidement vos demandes.</p>
        </div>
        <div class="tip">
          <i class="fas fa-chart-bar"></i>
          <p>Consultez les rapports pour analyser vos performances.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Boutons d'action -->
  <div class="quick-actions">
    <button class="btn primary" (click)="toggleNewDemandeForm(true)">
      <i class="fas fa-plus"></i>
      Nouvelle demande
    </button>
    <button class="btn secondary" (click)="toggleTableauDeBord(true)">
      <i class="fas fa-chart-bar"></i>
      Voir Tableau de bord complet
    </button>
  </div>
</div>
    <!-- TABLEAU DE BORD -->
    <div *ngIf="showTableauDeBord" class="dashboard-stats-section">

      <div class="dashboard-stats">
        <div class="stat-card total">
          <i class="fas fa-folder-open icon"></i>
          <h3>Total des demandes</h3>
          <p class="stat-value">{{ totalDemandes }}</p>
        </div>
        <div class="stat-card pending">
          <i class="fas fa-hourglass-half icon"></i>
          <h3>En attente</h3>
          <p class="stat-value">{{ demandesEnAttente }}</p>
        </div>
        <div class="stat-card approved">
          <i class="fas fa-check-circle icon"></i>
          <h3>Approuvées</h3>
          <p class="stat-value">{{ demandesApprouvees }}</p>
        </div>
        <div class="stat-card rejected">
          <i class="fas fa-times-circle icon"></i>
          <h3>Rejetées</h3>
          <p class="stat-value">{{ demandesRejetees }}</p>
        </div>
      </div>

      <div class="search-container">
        <i class="fas fa-search search-icon"></i>
        <input type="text" [(ngModel)]="searchTerm" (input)="applyFilter()" placeholder="Rechercher par type, montant, statut ou date...">
      </div>

      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Type</th>
              <th>Demandeur</th>
              <th>Montant</th>
              <th>Statut</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngIf="lastThreeDemandes.length === 0 && !errorMessage">
              <td colspan="7">Aucune demande récente à afficher.</td>
            </tr>
            <tr *ngFor="let demande of lastThreeDemandes">
              <td>{{ demande.id }}</td>
              <td>{{ demande.type }}</td>
              <td>{{ demande.responsible_pj?.nom }} {{ demande.responsible_pj?.prenom }}</td>
              <td>{{ demande.montant_total }}</td>
              <td>
                <span [ngClass]="{
                  'status-badge': true,
                  'status-pending': demande.status === 'En attente',
                  'status-approved': demande.status === 'Approuvée',
                  'status-rejected': demande.status === 'Rejetée'
                }">
                  {{ demande.status }}
                </span>
              </td>
              <td>{{ demande.date | date: 'dd-MM-yyyy' }}</td>
              <td>
                <button class="btn btn-sm secondary" (click)="goToDemande(demande.id)">
                  <i class="fas fa-eye"></i> Voir
                </button>
              </td>
            </tr>
            <tr *ngIf="errorMessage">
              <td colspan="7" class="text-center text-danger">Erreur : {{ errorMessage }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Nouvelle demande -->
    <div *ngIf="showNewDemandeForm">
      <app-demande-form
        (formSubmitted)="onFormSubmitted()"
        (formCanceled)="toggleNewDemandeForm(false)">
      </app-demande-form>
    </div>

    <!-- Liste des demandes -->
    <div *ngIf="showDemandeList">
      <app-demande-list></app-demande-list>
    </div>

    <!-- Récapitulatif des dépenses -->
    <div *ngIf="showDemandeRecap">
      <app-demande-recap></app-demande-recap>
    </div>

    <!-- Rapport des demandes -->
    <div *ngIf="showRapportDemande">
      <app-rapport-demande></app-rapport-demande>
    </div>

    <!-- Profil utilisateur -->
    <div *ngIf="showProfile" class="profile-container">
      <h2>Modifier mon profil</h2>

      <form (ngSubmit)="updateProfile()" #profileForm="ngForm">
        <div class="form-group">
          <label for="currentPassword">Mot de passe actuel</label>
          <input type="password" id="currentPassword" [(ngModel)]="currentPassword" name="currentPassword">
        </div>

        <div class="form-group">
          <label for="newPassword">Nouveau mot de passe</label>
          <input type="password" id="newPassword" [(ngModel)]="newPassword" name="newPassword">
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirmer le nouveau mot de passe</label>
          <input type="password" id="confirmPassword" [(ngModel)]="confirmPassword" name="confirmPassword">
        </div>

        <button type="submit" class="btn primary">Enregistrer</button>
        <button type="button" class="btn secondary" (click)="toggleProfile(false)">Annuler</button>
      </form>

      <div *ngIf="profileMessage" class="profile-message">{{ profileMessage }}</div>
    </div>
  </div>
</div>
<!-- Scroll to top -->
<button (click)="scrollToTop()" class="scroll-to-top" title="Remonter en haut">
  <i class="fas fa-arrow-up"></i>
</button>
