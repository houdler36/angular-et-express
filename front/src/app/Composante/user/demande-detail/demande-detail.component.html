<div class="container mx-auto p-6 bg-white shadow-lg rounded-lg max-w-4xl my-8">
  <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Détails de la Demande #{{ demande?.id }}</h2>

  <!-- Messages d'alerte/succès -->
  <div *ngIf="errorMessage" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
    <strong class="font-bold">Erreur !</strong>
    <span class="block sm:inline">{{ errorMessage }}</span>
  </div>
  <div *ngIf="successMessage" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert">
    <strong class="font-bold">Succès !</strong>
    <span class="block sm:inline">{{ successMessage }}</span>
  </div>

  <div *ngIf="demande">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
      <!-- Informations générales -->
      <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
        <h3 class="text-xl font-semibold text-gray-700 mb-3">Informations générales</h3>
        <div class="space-y-2">
          <p><span class="font-medium text-gray-600">Titre:</span> <span class="text-gray-900">{{ demande.title }}</span></p>
          <p><span class="font-medium text-gray-600">Statut:</span>
            <span [ngClass]="{
              'px-2 py-1 rounded-full text-xs font-semibold': true,
              'bg-yellow-100 text-yellow-800': demande.status === 'Pending',
              'bg-green-100 text-green-800': demande.status === 'Approved',
              'bg-red-100 text-red-800': demande.status === 'Rejected'
            }">
              {{ demande.status }}
            </span>
          </p>
          <p><span class="font-medium text-gray-600">Montant:</span> <span class="text-gray-900">{{ demande.amount | currency:'USD':'symbol':'1.2-2':'fr' }}</span></p>
          <p><span class="font-medium text-gray-600">Catégorie:</span> <span class="text-gray-900">{{ demande.category }}</span></p>
          <p><span class="font-medium text-gray-600">Date prévue:</span> <span class="text-gray-900">{{ demande.expectedDate | date:'fullDate' }}</span></p>
          <p><span class="font-medium text-gray-600">Soumise le:</span> <span class="text-gray-900">{{ demande.createdAt | date:'short' }}</span></p>
          <p *ngIf="demande.user"><span class="font-medium text-gray-600">Soumise par:</span> <span class="text-gray-900">{{ demande.user.username }}</span></p>
        </div>
      </div>

      <!-- Description et Justification -->
      <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
        <h3 class="text-xl font-semibold text-gray-700 mb-3">Description et Justification</h3>
        <div class="space-y-2">
          <p><span class="font-medium text-gray-600">Description:</span> <span class="text-gray-900">{{ demande.description }}</span></p>
          <p><span class="font-medium text-gray-600">Justification:</span> <span class="text-gray-900">{{ demande.justification }}</span></p>
        </div>
      </div>
    </div>

    <!-- Détails de la demande (si présents) -->
    <div *ngIf="demande.details && demande.details.length > 0" class="bg-gray-50 p-4 rounded-lg shadow-sm mb-6">
      <h3 class="text-xl font-semibold text-gray-700 mb-3">Détails de la demande</h3>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-100">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Désignation</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Montant</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">NIF</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">STAT</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Utilisateur Concerné</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <tr *ngFor="let detail of demande.details">
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ detail.designation }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ detail.amount | currency:'USD':'symbol':'1.2-2':'fr' }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ detail.nif }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ detail.stat }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ detail.concernedUserId }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>


    <!-- Pièces jointes -->
    <div class="bg-gray-50 p-4 rounded-lg shadow-sm mb-6">
      <h3 class="text-xl font-semibold text-gray-700 mb-3">Pièces jointes</h3>
      <p *ngIf="!demande.attachments || demande.attachments.length === 0" class="text-gray-600">Aucune pièce jointe.</p>
      <ul *ngIf="demande.attachments && demande.attachments.length > 0" class="list-disc list-inside text-gray-900">
        <li *ngFor="let attachment of demande.attachments">
          <a [href]="attachment.url" target="_blank" class="text-indigo-600 hover:underline">{{ attachment.name }}</a>
        </li>
      </ul>
    </div>

    <!-- Historique / Commentaires -->
    <div class="bg-gray-50 p-4 rounded-lg shadow-sm mb-6" *ngIf="demande.comments && demande.comments.length > 0">
      <h3 class="text-xl font-semibold text-gray-700 mb-3">Historique / Commentaires</h3>
      <div *ngFor="let comment of demande.comments" class="border-b border-gray-200 last:border-b-0 py-3">
        <p class="text-sm text-gray-600">
          <strong>{{ comment.author }}</strong> le {{ comment.date | date:'short' }}
        </p>
        <p class="text-gray-800 mt-1">{{ comment.text }}</p>
      </div>
    </div>

    <!-- Actions de la demande -->
    <div class="flex flex-wrap justify-center gap-4 mt-8">
      <button class="btn-secondary" routerLink="/demandes">
        <i class="fas fa-arrow-left mr-2"></i> Retour à la liste
      </button>

      <ng-container *ngIf="demande.status === 'Pending'">
        <button class="btn-primary" (click)="editDemande()">
          <i class="fas fa-edit mr-2"></i> Modifier
        </button>
        <button class="btn-danger" (click)="openDeleteConfirmModal()">
          <i class="fas fa-trash-alt mr-2"></i> Supprimer
        </button>
        <!-- Boutons d'approbation/rejet (pour les rôles appropriés) -->
        <button class="btn-success" (click)="approveDemande()">
          <i class="fas fa-check-circle mr-2"></i> Approuver
        </button>
        <button class="btn-warning" (click)="openRejectModal()">
          <i class="fas fa-times-circle mr-2"></i> Rejeter
        </button>
      </ng-container>

      <ng-container *ngIf="demande.status === 'Approved'">
        <span class="text-green-600 font-semibold text-lg"><i class="fas fa-check-circle mr-2"></i> Cette demande a été approuvée.</span>
      </ng-container>

      <ng-container *ngIf="demande.status === 'Rejected'">
        <span class="text-red-600 font-semibold text-lg"><i class="fas fa-times-circle mr-2"></i> Cette demande a été rejetée.</span>
      </ng-container>
    </div>

  </div>

  <!-- Messages de chargement/erreur si la demande n'est pas chargée -->
  <div *ngIf="!demande && demandeId" class="text-center text-gray-600 py-8">
    <p class="loading-message">Chargement des détails de la demande...</p>
  </div>
  <div *ngIf="!demande && !demandeId" class="text-center text-red-600 py-8">
    <p class="error-message">ID de demande non fourni ou demande introuvable.</p>
    <button class="btn-secondary mt-4" routerLink="/demandes">Retour à la liste</button>
  </div>

  <!-- Modale de confirmation de suppression -->
  <div *ngIf="showDeleteConfirmModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full">
      <h3 class="text-lg font-bold text-gray-800 mb-4">Confirmer la suppression</h3>
      <p class="text-gray-700 mb-6">Êtes-vous sûr de vouloir supprimer cette demande ? Cette action est irréversible.</p>
      <div class="flex justify-end space-x-3">
        <button class="btn-secondary" (click)="cancelDelete()">Annuler</button>
        <button class="btn-danger" (click)="confirmDelete()">Supprimer</button>
      </div>
    </div>
  </div>

  <!-- Modale de rejet de la demande -->
  <div *ngIf="showRejectModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full">
      <h3 class="text-lg font-bold text-gray-800 mb-4">Rejeter la demande</h3>
      <div class="mb-4">
        <label for="rejectReason" class="block text-sm font-medium text-gray-700 mb-1">Raison du rejet:</label>
        <textarea id="rejectReason" [(ngModel)]="rejectReason" rows="3"
                  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                  placeholder="Veuillez expliquer la raison du rejet..."></textarea>
      </div>
      <div class="flex justify-end space-x-3">
        <button class="btn-secondary" (click)="cancelReject()">Annuler</button>
        <button class="btn-warning" (click)="confirmReject()">Rejeter</button>
      </div>
    </div>
  </div>
</div>

<!-- Styles CSS de base pour les boutons et badges (à ajouter à votre demande-detail.component.scss) -->
