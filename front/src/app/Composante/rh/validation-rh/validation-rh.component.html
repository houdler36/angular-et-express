<div class="p-4">

    <h3 class="text-xl font-semibold mb-2">À traiter maintenant</h3>
    <p *ngIf="loadingATraiter" class="text-gray-500">Chargement...</p>
    <table *ngIf="!loadingATraiter && demandesATraiter.length > 0" class="w-full table-auto border border-gray-300">
        <thead class="bg-gray-200">
            <tr>
                <th class="px-2 py-1 border">Titre</th>
                <th class="px-2 py-1 border">Montant</th>
                <th class="px-2 py-1 border">Status</th>
                <th class="px-2 py-1 border">Validateurs du journal</th>
                <th class="px-2 py-1 border">Actions</th>
                <th class="px-2 py-1 border">Détails</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let demande of demandesATraiter">
                <td class="px-2 py-1 border">{{ demande.description || '—' }}</td>
                <td class="px-2 py-1 border">{{ demande.montant_total | currency:'MGA':'symbol':'1.0-0' }}</td>
                <td class="px-2 py-1 border">{{ demande.status }}</td>
                <td class="px-2 py-1 border">
                    <ul class="list-disc list-inside">
                        <li *ngFor="let validateur of demande.journal?.journal_validers || []">
                            {{ validateur.user?.username || 'N/A' }} (Ordre {{ validateur.ordre }})
                        </li>
                    </ul>
                </td>
                <td class="px-2 py-1 border">
                    
                    <span *ngIf="!demande.estTourUtilisateur" class="text-gray-500 italic">
                        Pas votre tour
                    </span>
                </td>
                <td class="px-2 py-1 border">
                    <button 
                        (click)="voirDetails(demande.id)" 
                        class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition"
                    >
                        Voir
                    </button>
                </td>
            </tr>
        </tbody>
    </table>
    <p *ngIf="!loadingATraiter && demandesATraiter.length === 0" class="text-gray-500 italic">
        Aucune demande à traiter actuellement
    </p>

    <h3 class="text-xl font-semibold mt-6 mb-2">En attente chez un autre validateur</h3>
    <p *ngIf="loadingEnAttente" class="text-gray-500">Chargement...</p>
    <table *ngIf="!loadingEnAttente && demandesEnAttente.length > 0" class="w-full table-auto border border-gray-300">
        <thead class="bg-gray-200">
            <tr>
                <th class="px-2 py-1 border">Titre</th>
                <th class="px-2 py-1 border">Montant</th>
                <th class="px-2 py-1 border">Status</th>
                <th class="px-2 py-1 border">Validateurs du journal</th>
                <th class="px-2 py-1 border">Validateur actuel</th>
                <th class="px-2 py-1 border">Détails</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let demande of demandesEnAttente">
                <td class="px-2 py-1 border">{{ demande.description || '—' }}</td>
                <td class="px-2 py-1 border">{{ demande.montant_total | currency:'MGA':'symbol':'1.0-0' }}</td>
                <td class="px-2 py-1 border">{{ demande.status }}</td>
                <td class="px-2 py-1 border">
                    <ul class="list-disc list-inside">
                        <li *ngFor="let validateur of demande.journal?.journal_validers || []">
                            {{ validateur.user?.username || 'N/A' }} (Ordre {{ validateur.ordre }})
                        </li>
                    </ul>
                </td>
                <td class="px-2 py-1 border">{{ demande.currentValidator || '—' }}</td>
                <td class="px-2 py-1 border">
                    <button 
                        (click)="voirDetails(demande.id)" 
                        class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition"
                    >
                        Voir
                    </button>
                </td>
            </tr>
        </tbody>
    </table>
    <p *ngIf="!loadingEnAttente && demandesEnAttente.length === 0" class="text-gray-500 italic">
        Aucune demande en attente chez d'autres validateurs
    </p>

    <h3 class="text-xl font-semibold mt-6 mb-2">Demandes finalisées</h3>
    <p *ngIf="loadingFinalisees" class="text-gray-500">Chargement...</p>
    <table *ngIf="!loadingFinalisees && demandesFinalisees.length > 0" class="w-full table-auto border border-gray-300">
        <thead class="bg-gray-200">
            <tr>
                <th class="px-2 py-1 border">Titre</th>
                <th class="px-2 py-1 border">Montant</th>
                <th class="px-2 py-1 border">Status</th>
                <th class="px-2 py-1 border">Validateurs du journal</th>
                <th class="px-2 py-1 border">Validateur final</th>
                <th class="px-2 py-1 border">Détails</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let demande of demandesFinalisees">
                <td class="px-2 py-1 border">{{ demande.description || '—' }}</td>
                <td class="px-2 py-1 border">{{ demande.montant_total | currency:'MGA':'symbol':'1.0-0' }}</td>
                <td class="px-2 py-1 border">{{ demande.status }}</td>
                <td class="px-2 py-1 border">
                    <ul class="list-disc list-inside">
                        <li *ngFor="let validateur of demande.journal?.journal_validers || []">
                            {{ validateur.user?.username || 'N/A' }} (Ordre {{ validateur.ordre }})
                        </li>
                    </ul>
                </td>
                <td class="px-2 py-1 border">{{ demande.finalValidator || '—' }}</td>
                <td class="px-2 py-1 border">
                    <button 
                        (click)="voirDetails(demande.id)" 
                        class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition"
                    >
                        Voir
                    </button>
                </td>
            </tr>
        </tbody>
    </table>
    <p *ngIf="!loadingFinalisees && demandesFinalisees.length === 0" class="text-gray-500 italic">
        Aucune demande finalisée pour le moment
    </p>

</div>