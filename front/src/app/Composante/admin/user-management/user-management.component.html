<div class="user-management">

  <!-- Message -->
  <div *ngIf="message" class="alert" [class.error]="isError" [class.success]="!isError">
    {{ message }}
  </div>

  <!-- Header avec bouton -->
  <div class="header">
    <h2>Gestion des utilisateurs</h2>
    <button class="btn-primary" (click)="openModal()">+ Ajouter un utilisateur</button>
  </div>

  <!-- Tableau des utilisateurs -->
  <table class="user-table" *ngIf="users.length > 0; else noUsers">
    <thead>
      <tr>
        <th>Nom</th>
        <th>Email</th>
        <th>Rôle</th>
        <th>Journaux</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let user of users">
        <td>{{ user.username }}</td>
        <td>{{ user.email }}</td>
        <td>{{ user.role }}</td>
        <td>{{ getJournalNamesForUser(user) }}</td>
      </tr>
    </tbody>
  </table>

  <ng-template #noUsers>
    <p class="empty">Aucun utilisateur trouvé.</p>
  </ng-template>

  <!-- Modale d'ajout utilisateur -->
  <div class="modal-backdrop" *ngIf="showAddUserModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Ajouter un utilisateur</h3>
        <button class="close-btn" (click)="closeModal()">×</button>
      </div>

      <div class="modal-body">
        <label>Nom :</label>
        <input type="text" [(ngModel)]="newUser.username" placeholder="Nom complet">

        <label>Email :</label>
        <input type="email" [(ngModel)]="newUser.email" placeholder="Adresse email">

        <label>Mot de passe :</label>
        <input type="password" [(ngModel)]="newUser.password" placeholder="Mot de passe">

        <label>Rôle :</label>
        <select [(ngModel)]="newUser.role" required>
          <option value="">-- Sélectionner --</option>
          <option value="user">Utilisateur</option>
          <option value="admin">Admin</option>
          <option value="approver">Approver</option>
          <option value="rh">RH</option>
          <option value="daf">DAF</option>
          <option value="caissier">Caissier</option>
        </select>

        <label>Journaux :</label>
        <div class="checkbox-group">
          <div *ngFor="let journal of journals">
            <input type="checkbox" 
                   (change)="onJournalChange($event, journal.id_journal)">
            {{ journal.nom_journal }}
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeModal()">Annuler</button>
        <button class="btn-primary" (click)="createUser()">Enregistrer</button>
      </div>
    </div>
  </div>

</div>
