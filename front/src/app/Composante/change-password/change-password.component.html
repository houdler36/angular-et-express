<div class="password-change-container">
  <h2>Changer le mot de passe</h2>

  <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()" novalidate>
    <div *ngIf="isCurrentUser" class="form-group">
      <label for="currentPassword"><span class="icon">🔒</span> Mot de passe actuel</label>
      <input type="password" id="currentPassword" formControlName="currentPassword" placeholder="•••••••">
      <div *ngIf="passwordForm.get('currentPassword')?.invalid && (passwordForm.get('currentPassword')?.dirty || passwordForm.get('currentPassword')?.touched)" class="alert-message">
        Le mot de passe actuel est requis.
      </div>
    </div>

    <div class="form-group">
      <label for="newPassword"><span class="icon">🔒</span> Nouveau mot de passe</label>
      <input type="password" id="newPassword" formControlName="newPassword" placeholder="Entrez un nouveau mot de passe">
      <div *ngIf="passwordForm.get('newPassword')?.invalid && (passwordForm.get('newPassword')?.dirty || passwordForm.get('newPassword')?.touched)" class="alert-message">
        Le nouveau mot de passe doit contenir au moins 6 caractères.
      </div>
    </div>

    <div class="form-group">
      <label for="confirmPassword"><span class="icon">🔒</span> Confirmer le mot de passe</label>
      <input type="password" id="confirmPassword" formControlName="confirmPassword" placeholder="Confirmez le nouveau mot de passe">
      <div *ngIf="passwordForm.hasError('passwordMismatch') && (passwordForm.get('confirmPassword')?.dirty || passwordForm.get('confirmPassword')?.touched)" class="alert-message">
        Les mots de passe ne correspondent pas.
      </div>
    </div>

    <div *ngIf="showSignatureField" class="form-group">
      <label for="signatureFile"><span class="icon">📁</span> Signature</label>
      <input type="file" id="signatureFile" (change)="onFileSelected($event)" accept="image/*">
    </div>

    <button type="submit" [disabled]="passwordForm.invalid">Changer le mot de passe</button>
  </form>

  <div *ngIf="message" [ngClass]="isError ? 'error-message' : 'success-message'" [@fadeIn]>
    {{ message }}
  </div>

  <!-- ✅ POPUP AVEC ICONE -->
  <div *ngIf="showPopup" class="popup-overlay" (click)="closePopup()">
    <div class="popup-content" [@popupAnimation]>
      <div class="popup-icon">✅</div>
      <h3>Succès</h3>
      <p>Votre mot de passe a été mis à jour avec succès.</p>
      <button class="popup-btn" (click)="closePopup()">OK</button>
    </div>
  </div>
</div>
